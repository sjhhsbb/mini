<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Activation System</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        h1, h2 {
            color: #333;
            text-align: center;
        }
        .tabs {
            display: flex;
            margin-bottom: 20px;
        }
        .tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            background-color: #e9ecef;
            cursor: pointer;
            border: 1px solid #ddd;
        }
        .tab.active {
            background-color: #007bff;
            color: white;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .form-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input[type="text"], input[type="date"] {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            box-sizing: border-box;
        }
        button {
            background-color: #4CAF50;
            color: white;
            padding: 12px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            width: 100%;
            font-size: 16px;
            margin-top: 10px;
        }
        button:hover {
            background-color: #45a049;
        }
        button.secondary {
            background-color: #007bff;
        }
        button.secondary:hover {
            background-color: #0069d9;
        }
        .result {
            margin-top: 20px;
            padding: 15px;
            border-radius: 5px;
            text-align: center;
            font-weight: bold;
        }
        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .user-info {
            margin-top: 20px;
            padding: 15px;
            background-color: #e9ecef;
            border-radius: 5px;
        }
        .user-list {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #ddd;
            padding: 10px;
            margin-top: 10px;
            border-radius: 5px;
        }
        .user-item {
            padding: 10px;
            border-bottom: 1px solid #eee;
        }
        .user-item:last-child {
            border-bottom: none;
        }
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>User Activation System</h1>
        
        <div class="tabs">
            <div class="tab active" onclick="switchTab('validation')">Validate User</div>
            <div class="tab" onclick="switchTab('addition')">Add New User</div>
            <div class="tab" onclick="switchTab('list')">User List</div>
        </div>
        
        <!-- Validation Tab -->
        <div id="validation" class="tab-content active">
            <div class="form-group">
                <label for="activationId">Enter Your Activation ID:</label>
                <input type="text" id="activationId" placeholder="Enter your Google ID (e.g., gg_116152060195741273040)">
            </div>
            <button onclick="validateUser()">Validate Activation</button>
            <button class="secondary" onclick="loadAllUsers()">Refresh User List</button>
            
            <div id="validationResult"></div>
            <div id="userInfo"></div>
        </div>
        
        <!-- Addition Tab -->
        <div id="addition" class="tab-content">
            <h2>Add New User</h2>
            <div class="form-group">
                <label for="userName">Name:</label>
                <input type="text" id="userName" placeholder="Enter user name">
            </div>
            <div class="form-group">
                <label for="userId">Google ID:</label>
                <input type="text" id="userId" placeholder="Enter Google ID (e.g., gg_1234567890)">
            </div>
            <div class="form-group">
                <label for="userKey">Access Key:</label>
                <input type="text" id="userKey" placeholder="Enter access key" value="XTPRIVATESKIN">
            </div>
            <div class="form-group">
                <label for="skinId">Skin ID (optional):</label>
                <input type="text" id="skinId" placeholder="Enter skin ID">
            </div>
            <div class="form-group">
                <label for="skinId1">Additional Skin ID (optional):</label>
                <input type="text" id="skinId1" placeholder="Enter additional skin ID">
            </div>
            <div class="form-group">
                <label for="startDate">Start Date (optional):</label>
                <input type="date" id="startDate">
            </div>
            <div class="form-group">
                <label for="expireDate">Expiration Date (optional):</label>
                <input type="date" id="expireDate">
            </div>
            <button onclick="addUser()">Add User</button>
            
            <div id="addResult"></div>
        </div>
        
        <!-- List Tab -->
        <div id="list" class="tab-content">
            <h2>User List</h2>
            <button onclick="loadAllUsers()">Load Users</button>
            <div id="userList" class="user-list"></div>
        </div>
    </div>

    <script>
        // Switch between tabs
        function switchTab(tabName) {
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Remove active class from all tabs
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show the selected tab content
            document.getElementById(tabName).classList.add('active');
            
            // Add active class to the clicked tab
            event.target.classList.add('active');
            
            // Load data if needed
            if (tabName === 'list') {
                loadAllUsers();
            }
        }
        
        // Load all users
        async function loadAllUsers() {
            try {
                const response = await fetch('/api/users');
                const data = await response.json();
                displayUserList(data.Users);
            } catch (error) {
                console.error('Error loading users:', error);
                document.getElementById('userList').innerHTML = '<div class="error">Error loading users</div>';
            }
        }
        
        // Display user list
        function displayUserList(users) {
            const userListDiv = document.getElementById('userList');
            if (!users || users.length === 0) {
                userListDiv.innerHTML = '<p>No users found</p>';
                return;
            }
            
            let html = '';
            users.forEach(user => {
                html += `<div class="user-item">
                    <strong>${user.cliente_NOMBRE}</strong> (${user.cliente_ID})<br>
                    Status: ${user.status === 1 ? 'Active' : 'Inactive'}<br>
                    Expires: ${user.cliente_DateExpired}
                </div>`;
            });
            
            userListDiv.innerHTML = html;
        }
        
        // Validate user by activation ID
        async function validateUser() {
            const activationId = document.getElementById('activationId').value.trim();
            const resultDiv = document.getElementById('validationResult');
            const userInfoDiv = document.getElementById('userInfo');
            
            // Clear previous results
            resultDiv.innerHTML = '';
            userInfoDiv.innerHTML = '';
            
            if (!activationId) {
                resultDiv.innerHTML = '<div class="result error">Please enter an activation ID</div>';
                return;
            }
            
            try {
                const response = await fetch(`/api/validate/${encodeURIComponent(activationId)}`);
                const result = await response.json();
                
                if (result.success) {
                    resultDiv.innerHTML = `<div class="result success">${result.message} Welcome, ${result.user.cliente_NOMBRE}!</div>`;
                    
                    // Display user information
                    let userInfoHTML = '<div class="user-info">';
                    userInfoHTML += '<h3>User Information:</h3>';
                    userInfoHTML += `<p><strong>Name:</strong> ${result.user.cliente_NOMBRE}</p>`;
                    userInfoHTML += `<p><strong>Activation ID:</strong> ${result.user.cliente_ID}</p>`;
                    userInfoHTML += `<p><strong>Start Date:</strong> ${result.user.cliente_DateStarted}</p>`;
                    userInfoHTML += `<p><strong>Expiration Date:</strong> ${result.user.cliente_DateExpired}</p>`;
                    
                    if (result.user.Client_VisibleSkin) {
                        userInfoHTML += `<p><strong>Skin ID:</strong> ${result.user.Client_VisibleSkin}</p>`;
                    }
                    
                    if (result.user.Client_VisibleSkin1) {
                        userInfoHTML += `<p><strong>Additional Skin ID:</strong> ${result.user.Client_VisibleSkin1}</p>`;
                    }
                    
                    userInfoHTML += '</div>';
                    userInfoDiv.innerHTML = userInfoHTML;
                } else {
                    resultDiv.innerHTML = `<div class="result error">${result.message}</div>`;
                }
            } catch (error) {
                console.error('Validation error:', error);
                resultDiv.innerHTML = '<div class="result error">An error occurred during validation</div>';
            }
        }
        
        // Add a new user
        async function addUser() {
            const userName = document.getElementById('userName').value.trim();
            const userId = document.getElementById('userId').value.trim();
            const userKey = document.getElementById('userKey').value.trim();
            const skinId = document.getElementById('skinId').value.trim();
            const skinId1 = document.getElementById('skinId1').value.trim();
            const startDate = document.getElementById('startDate').value;
            const expireDate = document.getElementById('expireDate').value;
            
            const resultDiv = document.getElementById('addResult');
            resultDiv.innerHTML = '';
            
            // Validate required fields
            if (!userName || !userId || !userKey) {
                resultDiv.innerHTML = '<div class="result error">Please fill in all required fields (Name, Google ID, Access Key)</div>';
                return;
            }
            
            // Prepare user data
            const userData = {
                cliente_NOMBRE: userName,
                cliente_ID: userId,
                Client_KeyAccecs: userKey,
                status: 1
            };
            
            // Add optional fields if provided
            if (skinId) userData.Client_VisibleSkin = skinId;
            if (skinId1) userData.Client_VisibleSkin1 = skinId1;
            if (startDate) {
                const startDateObj = new Date(startDate);
                userData.cliente_DateStarted = startDateObj.toLocaleDateString('en-GB');
            }
            if (expireDate) {
                const expireDateObj = new Date(expireDate);
                userData.cliente_DateExpired = expireDateObj.toLocaleDateString('en-GB');
            }
            
            try {
                const response = await fetch('/api/users', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(userData)
                });
                
                const result = await response.json();
                
                if (response.ok && result.success) {
                    resultDiv.innerHTML = `<div class="result success">${result.message}</div>`;
                    // Clear the form
                    document.getElementById('userName').value = '';
                    document.getElementById('userId').value = '';
                    document.getElementById('skinId').value = '';
                    document.getElementById('skinId1').value = '';
                    document.getElementById('startDate').value = '';
                    document.getElementById('expireDate').value = '';
                } else {
                    resultDiv.innerHTML = `<div class="result error">Error: ${result.error || 'Failed to add user'}</div>`;
                }
            } catch (error) {
                console.error('Error adding user:', error);
                resultDiv.innerHTML = '<div class="result error">An error occurred while adding the user</div>';
            }
        }
        
        // Allow Enter key to trigger validation
        document.getElementById('activationId').addEventListener('keyup', function(event) {
            if (event.key === 'Enter') {
                validateUser();
            }
        });
        
        // Set default dates for the add user form
        document.addEventListener('DOMContentLoaded', function() {
            const today = new Date();
            const nextYear = new Date();
            nextYear.setFullYear(today.getFullYear() + 1);
            
            document.getElementById('startDate').valueAsDate = today;
            document.getElementById('expireDate').valueAsDate = nextYear;
        });
    </script>
</body>
</html>